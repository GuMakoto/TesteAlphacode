<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Alphacode</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <script src="jquery.mask.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    <header class="container text-light row col-md-12 header">
        <div>
            <img src="../img/logo_alphacode.png" alt="Logo Alphacode">
        </div>
        <div>
            <h1>Cadastro de contatos</h1>
        </div>
    </header>
    <main>
        <section>
            <form action="index.php" method="POST"> 
                <div class="form-group container row col-md-12 margin-bottom">
                    <div class="col-md-6">
                        <label for="name">Nome completo</label>
                        <input type="text" class="form-control input-border" name="name" id="name" placeholder="Ex.: Letícia Pacheco dos Santos">
                    </div>
                    <div class="col-md-6">
                        <label for="date">Data de nascimento</label>
                        <input type="text" class="form-control input-border" name="date" id="date" maxlength="10" placeholder="Ex.: 03/10/2003">
                    </div>
                </div>
                <div class="form-group container row col-md-12 margin-bottom">
                    <div class="col-md-6">
                        <label for="email">Endereço de email</label>
                        <input type="email" class="form-control input-border" name="email" id="email" placeholder="Ex.: leticia@gmail.com">
                    </div>
                    <div class="col-md-6">
                        <label for="job">Profissão</label>
                        <input type="text" class="form-control input-border" name="job" id="job" placeholder="Ex.: Desenvolvedora Web">
                    </div>
                </div>
                <div class="form-group container row col-md-12 margin-bottom">
                    <div class="col-md-6">
                        <label for="telephone">Telefone para contato</label>
                        <input type="text" class="form-control input-border" name="telephone" id="telephone" placeholder="Ex.: (11) 4033-2019">
                    </div>
                    <div class="col-md-6">
                        <label for="cellphone">Celular para contato</label>
                        <input type="text" class="form-control input-border" name="cellphone" id="cellphone" placeholder="Ex.: (11) 98493-2039">
                    </div>
                </div>
                <div class="form-group container row col-md-12">
                    <div class="col-md-6">
                        <input type="checkbox" name="whatsapp" id="whatsapp">
                        <label class="form-check-label" for="">Número de celular possui Whatsapp</label>
                    </div>
                    <div class="col-md-6">
                        <input type="checkbox" name="notificationEmail" id="notificationEmail">
                        <label class="form-check-label" for="">Enviar notificações por E-mail</label>
                    </div>
                </div>
                <div class="form-group container row col-md-12 margin-bottom-checkbox">
                    <div class="col-md-6">
                        <input type="checkbox" name="sms" id="sms">
                        <label class="form-check-label" for="">Enviar notificações por SMS</label>
                    </div>
                </div>
                <div class="form-group container col-md-12 button-cadastro">
                    <button type="submit" class="btn btn-primary">Cadastrar Contato</button>
                </div>
            </form>
            <hr>
        </section>
        <section class="form-group container col-md-12">
            <table class="table table-striped table-borderless text-center mt-5">
                <thead>
                    <tr>
                        <th scope="col" class="bg-primary text-light">Nome</th>
                        <th scope="col" class="bg-primary text-light">Data de Nascimento</th>
                        <th scope="col" class="bg-primary text-light">E-mail</th>
                        <th scope="col" class="bg-primary text-light">Celular para contato</th>
                        <th scope="col" class="bg-primary text-light">Ações</th>
                    </tr>
                </thead>
                <tbody id="user-list">
                    
                </tbody>
            </table>
        </section>
    </main>
    <div class="container-fluid">
        <footer class="row text-light py-3 footer-container">
            <div>
                <p>Termos | Políticas</p>
            </div>
            <div>
                &copy; Copyright 2022 | Desenvolvido por
                <img src="../img/logo_rodape_alphacode.png" alt="Logo rodapé" class="img-rodape">
            </div>
            <div>
                <p>&copy; Alphacode IT Solutions 2022</p>
            </div>
        </footer>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script>
    
    <script>
        $(document).ready(function(){
            $('#date').on('input', function() {
                let  value = $(this).val();
                if (value.length === 2 || value.length === 5) {
                    $(this).val(value + '/');
                }
            });
            $('#telephone, #cellphone').on('input', function(){

            let phone = $(this).val();

            if (phone.split("").length > 15) {
                phone = phone.substr(0, 15);
            }
                phone = phone.replace(/\D/g, "");
                phone = phone.replace(/^(\d{2})(\d)/g, "($1) $2");
                phone = phone.replace(/(\d)(\d{4})$/, "$1-$2");

                $(this).val(phone);

            });
        });
        $(document).ready(function(){
            $('form').submit(function(e){
                e.preventDefault();

                const formData = $(this).serializeArray();

                $.ajax({
                    url: 'http://localhost/testealphacode/controller/usuarioController.php',
                    type: 'POST',
                    data: formData,
                    success: function(response){
                        window.location.reload();
                    }
                });
            });
        });

        $(document).ready(function() {
            $.ajax({
                url: 'http://localhost/testealphacode/controller/usuarioController.php',
                type: 'GET',
                dataType: 'json',
                success: function(response) {
                    var userList = $('#user-list');
                    $.each(response, function(index, usuario) {
                        let row = '<tr>' +
                                        '<td>' + usuario.nome + '</td>' +
                                        '<td>' + usuario.dataNascimento + '</td>' +
                                        '<td>' + usuario.email + '</td>' +
                                        '<td>' + usuario.celular + '</td>' +
                                        '<td> <button id="deletar" class="btn btn-danger btn-sm delete-usuario" onClick="deletarUsuario(' + usuario.id + ')"><i class="fas fa-trash"></i></button> </td>' +
                                   '</tr>';
                        userList.append(row);     
                                    
                    });
                },
            });
        });

        function deletarUsuario(id) {

            $.ajax({
                url: 'http://localhost/testealphacode/controller/usuarioController.php',
                type: 'DELETE',
                contentType: 'application/json',
                data: JSON.stringify({id: id}),
                success: function(response) {
                    window.location.reload();
                }
            })
                
        }
            
    

    </script>
</body>
</html>